---
title: Configuration
description: Configuration strategy for local, staging, and production environments.
---

## Principles

- Configuration is externalized via environment variables.
- Defaults are developer-friendly but never assumed for production.
- Sensitive values must be sourced from secret managers or encrypted stores.

## Suggested Domains

- API server settings (host, port, CORS)
- Database connection and pool sizing
- Auth settings (issuer, signing keys, token lifetime)
- Worker execution settings (concurrency, retries, timeouts)
- Observability sinks (logs, metrics, tracing)

## Change Safety

- Prefer additive config evolution.
- Document required and optional values per release.
- Validate startup configuration and fail fast on invalid values.

## Phase 1 Environment Variables

| Variable | Required | Description |
| --- | --- | --- |
| `DATABASE_URL` | Yes | PostgreSQL connection string used by API and migrations |
| `API_HOST` | No | API bind host (`127.0.0.1` default) |
| `API_PORT` | No | API bind port (`3001` default) |
| `FRONTEND_URL` | No | Allowed CORS origin and post-login redirect target |
| `SESSION_SECRET` | Yes | Session secret (32+ chars) |
| `AUTH_BOOTSTRAP_TOKEN` | Yes | One-time bootstrap token for initial authenticated session setup |
| `DEV_DEFAULT_TENANT_ID` | No | Optional local-development tenant UUID used when bootstrap creates first membership |
| `WEBAUTHN_RP_ID` | No | WebAuthn relying party id (`localhost` default) |
| `WEBAUTHN_RP_ORIGIN` | No | WebAuthn relying party origin (`FRONTEND_URL` default) |
| `SESSION_COOKIE_SECURE` | No | Enforce secure session cookies (`false` default for local dev) |
| `TOTP_ENCRYPTION_KEY` | Yes (prod) | 64-char hex key used to encrypt stored TOTP secrets (`[0;32]` fallback only for local dev) |
| `EMAIL_PROVIDER` | No | Email adapter (`console` default, `smtp` for production delivery) |
| `SMTP_HOST` | Required if `EMAIL_PROVIDER=smtp` | SMTP server host (must be non-empty; startup fails fast if missing) |
| `SMTP_PORT` | Required if `EMAIL_PROVIDER=smtp` | SMTP server port (`u16`; startup fails on invalid values) |
| `SMTP_USERNAME` | Required if `EMAIL_PROVIDER=smtp` | SMTP username (must be non-empty) |
| `SMTP_PASSWORD` | Required if `EMAIL_PROVIDER=smtp` | SMTP password (must be non-empty) |
| `SMTP_FROM_ADDRESS` | Required if `EMAIL_PROVIDER=smtp` | Sender address used for auth/invite emails (must be non-empty and valid) |
| `WORKFLOW_EXECUTION_MODE` | No | Workflow runtime mode (`inline` default, `queued` enables remote worker claim flow) |
| `WORKER_SHARED_SECRET` | Required if `WORKFLOW_EXECUTION_MODE=queued` | Shared bearer token used by worker-to-API internal claim channel |
| `WORKFLOW_WORKER_DEFAULT_LEASE_SECONDS` | No | Default worker job lease duration in seconds for internal claim requests (`30` default) |
| `WORKFLOW_WORKER_MAX_CLAIM_LIMIT` | No | Upper bound for jobs returned per worker claim request (`25` default) |
| `WORKER_API_BASE_URL` | Required for `qryvanta-worker` | API base URL used by worker process for internal claim requests |
| `WORKER_ID` | No | Stable worker identity sent to API (`worker-<pid>` default when unset) |
| `WORKER_CLAIM_LIMIT` | No | Number of jobs requested per worker poll (`10` default) |
| `WORKER_LEASE_SECONDS` | No | Job lease duration requested by worker claim calls (`30` default) |
| `WORKER_POLL_INTERVAL_MS` | No | Worker poll interval in milliseconds (`1500` default) |
| `NEXT_PUBLIC_API_BASE_URL` | No | Browser-facing API base URL for web app |

For local passkey and session stability, keep `FRONTEND_URL`, `WEBAUTHN_RP_ORIGIN`, and `NEXT_PUBLIC_API_BASE_URL` aligned to `localhost` hosts.

When `DEV_DEFAULT_TENANT_ID` is set, unauthenticated registration (`/auth/register`) follows that tenant's `registration_mode` (`invite_only` by default). Administrators can update this mode via `PUT /api/security/registration-mode`.

For production email operations, see `operations/email-delivery`.
