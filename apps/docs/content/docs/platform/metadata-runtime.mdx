---
title: Metadata Runtime
description: Core model for entities, fields, constraints, and publish lifecycle.
---

## Goal

Represent business models as metadata and execute runtime behavior from published definitions.

## Implemented Phase 2 Baseline

- Entity metadata (`/api/entities`) remains the root definition for logical and display names.
- Field metadata is managed per entity (`/api/entities/:entity_logical_name/fields`).
- Publish lifecycle is versioned and immutable (`/api/entities/:entity_logical_name/publish`).
- Runtime record APIs read only the latest published schema (`/api/runtime/:entity_logical_name/records`).

## Field Model (v1)

Supported field types:

- `text`
- `number`
- `boolean`
- `date`
- `datetime`
- `json`
- `relation` (many-to-one by target entity logical name)

Per-field constraints:

- `is_required`
- `is_unique` (excluding `json` fields)
- `default_value`
- `relation_target_entity` (required for `relation` fields)

## Lifecycle

1. Create/edit draft metadata (`entity_definitions` + `entity_fields`).
2. Publish immutable schema snapshot (`entity_published_versions`).
3. Runtime CRUD uses latest published version only.
4. Draft changes are inert until next publish.

## Runtime Validation Rules

- Runtime payload must be a JSON object.
- Unknown fields are rejected.
- Required fields must be present unless a default is provided.
- Field values are type-checked deterministically.
- Relation values must reference an existing target runtime record.
- Unique constraints are enforced via a tenant/entity/field hash index.
- Runtime record deletion is blocked when incoming relation references still exist.

Validation failures are surfaced through `AppError::Validation` and mapped to `400 Bad Request`.

## Runtime Query (v1)

- `GET /api/runtime/:entity_logical_name/records` supports offset pagination.
- `POST /api/runtime/:entity_logical_name/records/query` supports exact-match field filters plus offset pagination.
- Filter fields must exist in the published schema and pass field-type validation.
- Runtime query access requires `RuntimeRecordRead` permission and tenant-scoped repository access.
