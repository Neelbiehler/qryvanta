---
title: Automation
description: Trigger and action model for background business workflows.
---

Phase status: in progress.

## Workflow Model

- Trigger: `manual` or internal `runtime_record_created` per entity
- Canvas steps:
  - `log_message`
  - `create_runtime_record`
  - `condition` with `equals` / `not_equals` / `exists`
- Retry policy: per-workflow `max_attempts` (1-10)

## Execution Lifecycle

1. A workflow definition is saved in tenant scope (`/api/workflows`).
2. A run starts either by manual execute or runtime-record-created dispatch.
3. In `inline` mode, runs execute immediately in API request flow.
4. In `queued` mode, API enqueues run jobs and worker runtimes claim + execute them asynchronously.
5. Actions execute with bounded retry attempts.
6. Condition steps evaluate payload paths and execute one branch.
7. Failed terminal runs are marked `dead_lettered` with captured reason.
8. Run + attempt history is persisted for tenant observability.

## Execution Modes

- `inline`: simplest local setup, run executes inside API request handling.
- `queued`: API enqueues jobs and `qryvanta-worker` claims them through authenticated internal routes.
- `queued` workers can optionally claim by tenant-hash partition (`partition_count` + `partition_index`) for deterministic scale-out slices.

Use queued mode for isolation and independent worker scaling.

## Maker Automation Canvas

- Canvas editing supports trigger, action, and condition nodes.
- Step wiring supports drag/reconnect behavior with explicit drop targets (`before`, `after`, `to yes`, `to no`, `insert first`).
- Layout helpers include snap-to-grid and auto-arrange.
- Interaction model supports box selection, multi-node drag, and undo/redo (`Cmd/Ctrl+Z`, `Cmd/Ctrl+Shift+Z`).
- Builder and inspector are in-canvas overlays.
- Node picker supports keyboard insert (`A`) with fuzzy search.
- Function catalog supports category browsing and template insertion for trigger/logic/integration/data/operations paths.
- Workflow library supports master/detail navigation with dedicated edit and history routes (`/maker/automation/:workflow/edit`, `/maker/automation/:workflow/history`).
- `/maker/automation` is the workflow library landing page (not the editor), with explicit actions to open edit/history workspaces.
- Workflow library includes operational filters (enabled state, trigger type, last-run status) and sort controls (last run, failures, run volume, name).

## Endpoint Reference

Automation routes are defined in `API Conventions`:

- `GET /api/workflows`
- `POST /api/workflows`
- `POST /api/workflows/:workflow_logical_name/execute`
- `GET /api/workflows/runs?workflow_logical_name=&limit=50&offset=0`
- `GET /api/workflows/runs/:run_id/attempts`
- `POST /api/internal/worker/jobs/claim`
- `POST /api/internal/worker/heartbeat`
- `GET /api/internal/worker/jobs/stats` (supports optional partition filters)

## Reliability Requirements

- Idempotent action handling where possible
- Retry with bounded attempts
- Dead-letter storage for repeated failures
- Full traceability by tenant and actor
